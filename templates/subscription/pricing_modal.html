<!-- Paystack Pricing Modal -->
<div
  id="pricingModal"
  class="fixed inset-0 z-50 hidden"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <!-- Backdrop -->
  <div
    class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity"
    onclick="closePricingModal()"
  ></div>

  <div
    class="flex min-h-full items-center justify-center p-4 text-center sm:p-0"
  >
    <div
      class="relative transform overflow-hidden rounded-2xl bg-white dark:bg-slate-900 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg border border-slate-200 dark:border-slate-800"
    >
      <!-- Close Button -->
      <button
        onclick="closePricingModal()"
        class="absolute top-4 right-4 text-slate-400 hover:text-slate-500 dark:hover:text-slate-300"
      >
        <i data-feather="x" class="w-5 h-5"></i>
      </button>

      <div class="p-6 sm:p-8">
        <div class="text-center mb-6">
          <div
            class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-primary-100 dark:bg-primary-900/30 mb-4"
          >
            <i
              data-feather="zap"
              class="h-6 w-6 text-primary-600 dark:text-primary-400"
            ></i>
          </div>
          <h3
            class="text-xl font-bold text-slate-900 dark:text-white"
            id="modal-title"
          >
            Activate Plan
          </h3>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Secure your business data and unlock all features.
          </p>
        </div>

        <!-- Pricing Card -->
        <div
          class="bg-slate-50 dark:bg-slate-800/50 rounded-xl p-4 mb-6 border border-slate-100 dark:border-slate-800"
        >
          <div class="flex justify-between items-end mb-4">
            <div>
              <p class="text-sm text-slate-500 dark:text-slate-400">
                Monthly Subscription
              </p>
              <div class="flex items-baseline gap-2">
                <span class="text-2xl font-bold text-slate-900 dark:text-white"
                  >₦3,000</span
                >
                <span class="text-sm text-slate-400 line-through">₦7,000</span>
              </div>
            </div>
            <span
              class="inline-flex items-center rounded-full bg-green-100 dark:bg-green-900/30 px-2.5 py-0.5 text-xs font-medium text-green-800 dark:text-green-300"
            >
              Founders Discount
            </span>
          </div>

          <ul class="space-y-2 text-sm text-slate-600 dark:text-slate-400">
            <li class="flex items-center gap-2">
              <i data-feather="check" class="w-4 h-4 text-primary-500"></i>
              Unlimited Sales & Inventory
            </li>
            <li class="flex items-center gap-2">
              <i data-feather="check" class="w-4 h-4 text-primary-500"></i>
              Digital Receipts & Reports
            </li>
            <li class="flex items-center gap-2">
              <i data-feather="check" class="w-4 h-4 text-primary-500"></i>
              Priority Support
            </li>
          </ul>
        </div>

        <!-- Pay Button -->
        <button
          onclick="payWithPaystack()"
          class="w-full py-3.5 px-4 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-primary-600/30 flex items-center justify-center gap-2"
        >
          <i data-feather="lock" class="w-4 h-4"></i>
          Pay ₦3,000 Securely
        </button>

        <p
          class="mt-4 text-center text-xs text-slate-400 flex items-center justify-center gap-1"
        >
          <i data-feather="shield" class="w-3 h-3"></i>
          Secured by Paystack
        </p>
      </div>
    </div>
  </div>
</div>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
  const paymentForm = document.getElementById("paymentForm");
  const publicKey = "pk_test_2ce29c34eaf136be2d6582ecad6cf8c3be3fc771"; // Dummy Key
  const userEmail = "{{ request.user.email }}";
  const amount = 3000 * 100; // Amount in kobo

  function payWithPaystack() {
    const handler = PaystackPop.setup({
      key: publicKey,
      email: userEmail,
      amount: amount,
      currency: "NGN",
      ref: "" + Math.floor(Math.random() * 1000000000 + 1),
      metadata: {
        custom_fields: [
          {
            display_name: "Plan",
            variable_name: "plan",
            value: "basic",
          },
        ],
      },
      callback: function (response) {
        // Verify transaction on backend
        window.location.href =
          "{% url 'verify_payment' %}?reference=" + response.reference;
      },
      onClose: function () {
        alert("Transaction was not completed, window closed.");
      },
    });
    handler.openIframe();
  }

  function openPricingModal() {
    document.getElementById("pricingModal").classList.remove("hidden");
  }

  function closePricingModal() {
    document.getElementById("pricingModal").classList.add("hidden");
  }
</script>
