<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>{% block title %}POS-Lite{% endblock %}</title>
    <script src="https://unpkg.com/@hotwired/turbo@8.0.0/dist/turbo.es2017-umd.js"></script>
    

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
            },
            colors: {
              primary: {
                50: "#eef2ff",
                100: "#e0e7ff",
                200: "#c7d2fe",
                300: "#a5b4fc",
                400: "#818cf8",
                500: "#6366f1",
                600: "#4f46e5",
                700: "#4338ca",
                800: "#3730a3",
                900: "#312e81",
                950: "#1e1b4b",
              },
            },
          },
        },
      };
    </script>

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Theme Logic -->
    <script>
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>

    <style>
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #475569;
      }

      /* Hide scrollbar for clean mobile feel but keep functionality */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      /* Glassmorphism utilities */
      .glass {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
      }
      .dark .glass {
        background: rgba(15, 23, 42, 0.7);
      }

      /* Button Press Animation */
      button,
      a[role="button"],
      input[type="submit"],
      input[type="button"],
      .btn {
        transition: all 0.15s ease;
        position: relative;
      }

      button:active,
      a[role="button"]:active,
      input[type="submit"]:active,
      input[type="button"]:active,
      .btn:active {
        transform: scale(0.95);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* Hover effect for buttons */
      button:hover:not(:disabled),
      a[role="button"]:hover,
      input[type="submit"]:hover:not(:disabled),
      input[type="button"]:hover:not(:disabled),
      .btn:hover {
        transform: translateY(-1px);
      }

      /* Disabled button state */
      button:disabled,
      input[type="submit"]:disabled,
      input[type="button"]:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
    </style>
    {% block extra_css %}{% endblock %}
  </head>
  <body
    class="h-full bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-50 antialiased transition-colors duration-200"
  >
    <div id="preloader" class="preloader-overlay"><div class="preloader-spinner"></div></div>
    {% block layout %}{% endblock %}

    <script>
      feather.replace();

      // HTMX Configuration
      document.addEventListener("DOMContentLoaded", function () {
        // Configure HTMX
        htmx.config.historyCacheSize = 20;
        htmx.config.defaultSwapStyle = "innerHTML";
        htmx.config.scrollBehavior = "smooth";

        // Re-initialize Feather icons after HTMX swap
        document.body.addEventListener("htmx:afterSwap", function (event) {
          feather.replace();
          attachButtonSounds(); // Re-attach sounds after HTMX swap
        });

        // Initialize button sounds
        attachButtonSounds();
      });

      document.addEventListener('turbo:visit', function(){ var p=document.getElementById('preloader'); if(p) p.classList.add('show'); });
      document.addEventListener('turbo:load', function(){ var p=document.getElementById('preloader'); if(p) p.classList.remove('show'); feather.replace(); attachButtonSounds(); });
      document.addEventListener('turbo:render', function(){ var p=document.getElementById('preloader'); if(p) p.classList.remove('show'); });

      function ensureChartJs(callback){
        if(window.Chart){ callback(); return; }
        var s=document.createElement('script');
        s.src='https://cdn.jsdelivr.net/npm/chart.js';
        s.onload=callback;
        document.head.appendChild(s);
      }

      function initCharts(){
        var canvas=document.getElementById('revenueChart');
        if(!canvas) return;
        var loader = document.getElementById('dashboard-loader') || (canvas.parentElement ? canvas.parentElement.querySelector('.chart-loader') : null);
        var labels = [];
        var series = [];
        try { labels = JSON.parse(canvas.dataset.labels || '[]'); } catch(e){}
        try { series = JSON.parse(canvas.dataset.series || '[]'); } catch(e){}
        var type = canvas.dataset.type || 'bar';
        var color = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim() || '#4f46e5';
        if(canvas._chartInstance){ canvas._chartInstance.destroy(); }
        canvas._chartInstance = new Chart(canvas, {
          type: type,
          data: { labels: labels, datasets: [{ label: 'Revenue (â‚¦)', data: series, backgroundColor: color, borderColor: color, borderRadius: 6, tension: 0.3 }] },
          options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
        });
        canvas.style.opacity = '1';
        if(loader) loader.style.display = 'none';
      }

      document.addEventListener('turbo:load', function(){ ensureChartJs(initCharts); });
      document.addEventListener('DOMContentLoaded', function(){ ensureChartJs(initCharts); });

      // Button Click Sound System
      function attachButtonSounds() {
        // Create audio context for click sounds
        const AudioContext = window.AudioContext || window.webkitAudioContext;

        if (!AudioContext) {
          console.log("Web Audio API not supported");
          return;
        }

        const audioContext = new AudioContext();

        // Function to play click sound
        function playClickSound() {
          // Resume audio context if suspended (required for user interaction)
          if (audioContext.state === "suspended") {
            audioContext.resume();
          }

          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          // Click sound parameters
          oscillator.frequency.value = 800; // Frequency in Hz
          oscillator.type = "sine";

          // Volume envelope
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.1
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.1);
        }

        // Attach click sound to all buttons
        const buttons = document.querySelectorAll(
          'button, input[type="submit"], input[type="button"], a[role="button"], .btn'
        );

        buttons.forEach((button) => {
          // Remove existing listener if any
          button.removeEventListener("click", playClickSound);
          // Add new listener
          button.addEventListener("click", playClickSound);
        });
      }
    </script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
